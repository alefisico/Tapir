[general]
do_stat_variations: False
do_fake_data: False 
category_templates: template_sl 

#definition of all process lists
process_lists:
  base_processes
#  inclusive_procs
  ttjets_powheg_exclusive
#  ttjets_powheg_isr_up
#  ttjets_powheg_isr_down
#  ttjets_powheg_fsr_up
#  ttjets_powheg_fsr_down
#  ttjets_powheg_tune_up
#  ttjets_powheg_tune_down
#  ttjets_powheg_hdamp_up
#  ttjets_powheg_hdamp_down
  sl_data
#  dl_data

#Process lists that are actually included in analysis
processes:
  base_processes
  ttjets_powheg_exclusive
#  inclusive_procs
#  ttjets_powheg_isr_up
#  ttjets_powheg_isr_down
#  ttjets_powheg_fsr_up
#  ttjets_powheg_fsr_down
#  ttjets_powheg_tune_up
#  ttjets_powheg_tune_down
#  ttjets_powheg_hdamp_up
#  ttjets_powheg_hdamp_down
  sl_data
#  dl_data

#Which groups of categories to run limits for
analysis_groups:
  group_sl
#  group_dl
#  group_sldl
#  group_sl_4tag
#  group_dl_4tag
#  group_sldl_4tag
#  group_crosscheck
#  group_sl_2tag
#  group_dl_2tag
#  group_sldl_2tag
#commented out right now because it crashes the limits
#  group_fh
name: SLDL
debug: false
mem_python_config: $CMSSW_BASE/python/TTH/MEAnalysis/cfg_withME.py
##mem_python_config: $CMSSW_BASE/python/TTH/MEAnalysis/cfg_noME.py

process_order:
  ttH_hbb
#  ttH_nonhbb
#  stop
#  ttv
#  diboson
#  dy
  ttbarPlusB
  ttbarPlus2B
  ttbarPlusBBbar
  ttbarPlusCCbar
  ttbarOther

json: $CMSSW_BASE/src/TTH/MEAnalysis/data/Cert_294927-306462_13TeV_PromptReco_Collisions17_JSON.txt

runs:

[lumi]
SingleMuon: 59970.00
EGamma: 59970.00
MuonEG: 59970.00
DoubleMuon: 59970.00
BTagCSV: 59970.00
JetHT: 59970.00
Common: 59970.00

[samples]
samples_list:
  ttHTobb_M125_TuneCP5_13TeV-powheg-pythia8
#  ttHToNonbb_M125_TuneCP5_13TeV-powheg-pythia8
  TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8
#  TTToHadronic_TuneCP5_13TeV-powheg-pythia8
  TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8
#  DataDrivenQCD
#  QCD_HT300to500_TuneCUETP8M1_13TeV-madgraphMLM-pythia8
#  QCD_HT500to700_TuneCUETP8M1_13TeV-madgraphMLM-pythia8
#  QCD_HT700to1000_TuneCUETP8M1_13TeV-madgraphMLM-pythia8
#  QCD_HT1000to1500_TuneCUETP8M1_13TeV-madgraphMLM-pythia8
#  QCD_HT1500to2000_TuneCUETP8M1_13TeV-madgraphMLM-pythia8
#  QCD_HT2000toInf_TuneCUETP8M1_13TeV-madgraphMLM-pythia8
#  TT_TuneCUETP8M2T4_13TeV-powheg-fsrup-pythia8
#  TT_TuneCUETP8M2T4_13TeV-powheg-fsrdown-pythia8
#  TT_TuneCUETP8M2T4_13TeV-powheg-isrup-pythia8
#  TT_TuneCUETP8M2T4_13TeV-powheg-isrdown-pythia8
#  TT_hdampDOWN_TuneCUETP8M2T4_13TeV-powheg-pythia8
#  TT_hdampUP_TuneCUETP8M2T4_13TeV-powheg-pythia8
#  TT_TuneCUETP8M2T4down_13TeV-powheg-pythia8
#  TT_TuneCUETP8M2T4up_13TeV-powheg-pythia8
#  TTWJetsToLNu_TuneCUETP8M1_13TeV-amcatnloFXFX-madspin-pythia8
#  TTWJetsToQQ_TuneCUETP8M1_13TeV-amcatnloFXFX-madspin-pythia8
#  TTZToLLNuNu_M-10_TuneCUETP8M1_13TeV-amcatnlo-pythia8
#  TTZToQQ_TuneCUETP8M1_13TeV-amcatnlo-pythia8
#  ST_tW_antitop_5f_inclusiveDecays_13TeV-powheg-pythia8_TuneCUETP8M2T4
#  ST_tW_top_5f_inclusiveDecays_13TeV-powheg-pythia8_TuneCUETP8M2T4
#  ST_t-channel_antitop_4f_inclusiveDecays_TuneCUETP8M2T4_13TeV-powhegV2-madspin
#  ST_t-channel_top_4f_inclusiveDecays_TuneCUETP8M2T4_13TeV-powhegV2-madspin
#  ST_s-channel_4f_leptonDecays_13TeV-amcatnlo-pythia8_TuneCUETP8M1
#  WW_TuneCUETP8M1_13TeV-pythia8
#  WZ_TuneCUETP8M1_13TeV-pythia8
#  ZZ_TuneCUETP8M1_13TeV-pythia8
#  DYJetsToLL_M-10to50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8
#  DYJetsToLL_M-50_TuneCUETP8M1_13TeV-madgraphMLM-pythia8
#  WJetsToLNu_TuneCUETP8M1_13TeV-madgraphMLM-pythia8
  DoubleMuon
  MuonEG
  SingleMuon
  EGamma
#  JetHT
#  BTagCSV

[TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8]
#files_load_step2: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May14_v1/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8.txt
files_load_step2: $CMSSW_BASE/src/TTH/MEAnalysis/test/simpleJob/nanoAODPostproc_simpleJobs_TTToSemiLeptonic2018.txt
#files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May14_v1/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/test/simpleJob/nanoAODPostproc_simpleJobs_TTToSemiLeptonic2018.txt
files_load_postproc:
step_size_sparsinator: 1
debug_max_files: 100
ngen_weight: 1 ##33359980483.7
schema: mc
boosted: false
process: ttbarUnsplit
#http://pdg.lbl.gov/2013/reviews/rpp2013-rev-top-quark.pdf page 3, A-C
#831.76*2*0.6741*(1.0 - 0.6741)
xsec: 365.45736135
step1_tree_name: Events
test_events: 1000 
treemodel: ROOT.TTH_MEAnalysis.TreeDescriptionMCFloat
tags: 

[TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8]
files_load_step2: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May14_v1/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May14_v1/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8.txt
files_load_postproc:
step_size_sparsinator: 1
debug_max_files: 100
ngen_weight: 1  ##568232377.744
schema: mc
boosted: false
process: ttbarUnsplit
#http://pdg.lbl.gov/2013/reviews/rpp2013-rev-top-quark.pdf page 3, A-C
#831.76*(1.0 - 0.6741)**2
xsec: 88.341903326
step1_tree_name: nanoAOD/Events
test_events: 5000 
treemodel: ROOT.TTH_MEAnalysis.TreeDescriptionMCFloat
tags: scaleME ttjets


[ttHTobb_M125_TuneCP5_13TeV-powheg-pythia8]
#files_load_step2: $CMSSW_BASE/src/TTH/MEAnalysis/test/simpleJob_files.txt 
#files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/test/simpleJob_files.txt 
files_load_step2: $CMSSW_BASE/src/TTH/MEAnalysis/test/nanoAODPostProc_simpletJobs_tthbb2018.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/test/nanoAODPostProc_simpletJobs_tthbb2018.txt
files_load_postproc: 
step_size_sparsinator: 1
debug_max_files: 10
ngen_weight: 3298133.74764
schema: mc
boosted: false
#https://twiki.cern.ch/twiki/bin/view/LHCPhysics/CERNYellowReportPageAt1314TeV#s_13_0_TeV
#0.5085 * 0.577
xsec: 0.2934045
step1_tree_name: Events
test_events: 5000 
treemodel: ROOT.TTH_MEAnalysis.TreeDescriptionMCFloat
tags: tth

[SingleMuon]
files_load_step2: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May1/SingleMuon.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May1/SingleMuon.txt
files_load_postproc: 
step_size_sparsinator: 1
debug_max_files: 10
ngen_weight: -1
schema: data
boosted: false
classifier_db_path:
process: data_m
xsec: 1.0
step1_tree_name: Events
test_events: 10000
treemodel: ROOT.TTH_MEAnalysis.TreeDescriptionFloat
tags:

[EGamma]
files_load_step2: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May1/SingleElectron.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May1/SingleElectron.txt
files_load_postproc: 
step_size_sparsinator: 10
debug_max_files: 10
ngen_weight: -1
schema: data
boosted: false
classifier_db_path:
process: data_m
xsec: 1.0
step1_tree_name: Events
test_events: 50000
treemodel: ROOT.TTH_MEAnalysis.TreeDescriptionFloat
tags:

[DoubleMuon]
files_load_step2: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May1/DoubleMuon.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May1/DoubleMuon.txt
files_load_postproc: 
step_size_sparsinator: 10
debug_max_files: 500
ngen_weight: -1
schema: data
boosted: false
classifier_db_path:
process: data_mm
xsec: 1.0
step1_tree_name: Events
test_events: 50000
treemodel: ROOT.TTH_MEAnalysis.TreeDescriptionFloat
tags:

[MuonEG]
files_load_step2: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May1/MuonEG.txt
files_load_step1: $CMSSW_BASE/src/TTH/MEAnalysis/gc/datasets/May1/MuonEG.txt
files_load_postproc: 
step_size_sparsinator: 10
debug_max_files: 500
ngen_weight: -1
schema: data
boosted: false
classifier_db_path:
process: data_em
xsec: 1.0
step1_tree_name: Events
test_events: 50000
treemodel: ROOT.TTH_MEAnalysis.TreeDescriptionFloat
tags:


###
### Cuts
###

[cuts]
cuts_list:
  triggerPath_m
  triggerPath_e
  triggerPath_mm
  triggerPath_em
  triggerPath_ee
  triggerPath_fh
  triggerPath_bt
  process_ttbarPlusBBbar
  process_ttbarPlus2B
  process_ttbarPlusB
  process_ttbarPlusCCbar
  process_ttbarOther
#  process_ttH_hcc
#  process_ttH_hww
#  process_ttH_hzz
#  process_ttH_htt
#  process_ttH_hgg
#  process_ttH_hgluglu
#  process_ttH_hzg

[triggerPath_m]
sparsinator:
  triggerPath 1 2
skim: (is_sl==1 && HLT_ttH_SL_mu==1 && abs(leps_pdgId[0])==13)

[triggerPath_e]
sparsinator:
  triggerPath 2 3
skim: (is_sl==1 && HLT_ttH_SL_el==1 && abs(leps_pdgId[0])==11)

[triggerPath_mm]
sparsinator:
  triggerPath 3 4
skim: (is_dl==1 && HLT_ttH_DL_mumu==1 && abs(leps_pdgId[0])==13 && abs(leps_pdgId[1])==13)

[triggerPath_em]
sparsinator:
  triggerPath 4 5
skim: (is_dl==1 && HLT_ttH_DL_elmu==1 && ((abs(leps_pdgId[0])==13 && abs(leps_pdgId[1])==11) || (abs(leps_pdgId[0])==11 && abs(leps_pdgId[1])==13)))

[triggerPath_ee]
sparsinator:
  triggerPath 5 6
skim: (is_dl==1 && HLT_ttH_DL_elel==1 && abs(leps_pdgId[0])==11 && abs(leps_pdgId[1])==11)

[triggerPath_fh]
sparsinator:
  triggerPath 6 7
skim: (is_fh==1 && (HLT_ttH_FH==1 || HLT_BIT_HLT_PFHT1050==1) && json==1)

[triggerPath_bt]
sparsinator:
  triggerPath 7 8
skim: (is_fh==1 && (HLT_ttH_FH==1 && HLT_BIT_HLT_PFHT1050==0) && json==1)

[process_ttbarPlusBBbar]
sparsinator:
  ttCls 53 60
skim: (ttCls >= 53)

[process_ttbarPlus2B]
sparsinator:
  ttCls 52 53
skim: (ttCls == 52)

[process_ttbarPlusB]
sparsinator:
  ttCls 51 52
skim: (ttCls == 51)

[process_ttbarPlusCCbar]
sparsinator:
  ttCls 41 46
skim: (ttCls >= 41 && ttCls <= 45)

[process_ttbarOther]
sparsinator:
  ttCls 0 1
skim: (ttCls == 0)

###
### Process lists
###
# Each process list consists of a number of processes

#common for all kinds of analyses
[base_processes]
split_by_trigger_path: true
schema: mc
processes:
  ttH_hbb
#  ttH_nonhbb
#  st_t
#  stbar_t
#  st_s
#  st_tw
#  stbar_tw
#  ttw_wqq
#  ttw_wlnu
#  ttz_zqq
#  ttz_zllnunu
#  dy_10_50
#  dy_50_inf
#  ww
#  wz
#  zz

# POWHEG-based tt+jets
[ttjets_powheg_exclusive]
split_by_trigger_path: false
schema: mc
processes:
  ttjets_sl_powheg_ttbarPlusBBbar
  ttjets_sl_powheg_ttbarPlus2B
  ttjets_sl_powheg_ttbarPlusB
  ttjets_sl_powheg_ttbarPlusCCbar
  ttjets_sl_powheg_ttbarOther

###############
### Processes #
###############
# Each process consists of an in-out pair, where the "in" part refers to a DAS sample
# and the "out" refers to a real physical process in the final output histograms.
# For details, see the definition of the Process class in AnalysisSpecificationClasses.py

###
### MC processes
###

[ttH_hbb]
in: ttHTobb_M125_TuneCP5_13TeV-powheg-pythia8
out: ttH_hbb

###
### TT+jets samples split by top pair decay mode
###

#SL
[ttjets_sl_powheg_ttbarOther]
in: TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8
out: ttbarOther
cuts: process_ttbarOther

[ttjets_sl_powheg_ttbarPlusBBbar]
in: TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8
out: ttbarPlusBBbar
cuts: process_ttbarPlusBBbar

[ttjets_sl_powheg_ttbarPlus2B]
in: TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8
out: ttbarPlus2B
cuts: process_ttbarPlus2B

[ttjets_sl_powheg_ttbarPlusB]
in: TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8
out: ttbarPlusB
cuts: process_ttbarPlusB

[ttjets_sl_powheg_ttbarPlusCCbar]
in: TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8
out: ttbarPlusCCbar
cuts: process_ttbarPlusCCbar

#DL
[ttjets_dl_powheg_ttbarOther]
in: TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8
out: ttbarOther
cuts: process_ttbarOther

[ttjets_dl_powheg_ttbarPlusBBbar]
in: TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8
out: ttbarPlusBBbar
cuts: process_ttbarPlusBBbar

[ttjets_dl_powheg_ttbarPlus2B]
in: TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8
out: ttbarPlus2B
cuts: process_ttbarPlus2B

[ttjets_dl_powheg_ttbarPlusB]
in: TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8
out: ttbarPlusB
cuts: process_ttbarPlusB

[ttjets_dl_powheg_ttbarPlusCCbar]
in: TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8
out: ttbarPlusCCbar
cuts: process_ttbarPlusCCbar


#[importconfig]
#parent: $CMSSW_BASE/src/TTH/MEAnalysis/test/default.cfg
#[general]
###
### Data processes
###

[data_m]
in: SingleMuon
out: data
lumi: SingleMuon
cuts: triggerPath_m

[data_e]
in: EGamma
out: data
lumi: EGamma
cuts: triggerPath_e

[data_mm]
in: DoubleMuon
out: data
lumi: DoubleMuon
cuts: triggerPath_mm

[data_em]
in: MuonEG
out: data
lumi: MuonEG
cuts: triggerPath_em

[data_ee]
in: EGamma
out: data
lumi: EGamma
cuts: triggerPath_ee

[sl_data]
split_by_trigger_path: true
schema: data
processes:
  data_m
  data_e


[template_sl]
mc_processes:
  base_processes
  ttjets_powheg_exclusive
#  ttjets_powheg_fsr_down
#  ttjets_powheg_fsr_up
#  ttjets_powheg_isr_down
#  ttjets_powheg_isr_up
data_processes: sl_data
common_shape_uncertainties: common_shape_uncertainties_inclusive
common_scale_uncertainties: common_scale_uncertainties
scale_uncertainties: scale_uncertainties
signal_processes:
  ttH_hbb
#  ttH_nonhbb

[common_shape_uncertainties_inclusive]
CMS_res_j: 1

[common_scale_uncertainties]
lumi: 1.025

[scale_uncertainties]
ttH_hbb:
  QCDscale_ttH 0.908/1.058

[group_sl]
categories:
    sl_presel
#  sl_j4_t3
#  sl_j4_tge4
#  sl_j5_t3
#  sl_j5_tge4
#  sl_jge6_t3
#  sl_jge6_tge4

[sl_presel]
template: template_sl
discriminator: jetsByPt_0_pt jetsByPt_0_pt 100,0,1000
control_variables:
  nPVs nPVs 50,0,100
  numJets numJets 14,0,14
  nBDeepCSVM nBDeepCSVM 6,0,6
  leps_0_pt leps_0_pt 100,0,1000
  leps_0_eta leps_0_eta 21,-5,5
  met_pt met_pt 50,0,500
  ht ht 200,0,2000
  jetsByPt_0_pt jetsByPt_0_pt 100,0,1000
  jetsByPt_1_pt jetsByPt_1_pt 100,0,1000
  jetsByPt_2_pt jetsByPt_2_pt 100,0,1000
  jetsByPt_3_pt jetsByPt_3_pt 100,0,1000
  jetsByPt_0_btagCSV jetsByPt_0_btagCSV 20,0,1
  jetsByPt_1_btagCSV jetsByPt_1_btagCSV 20,0,1
  jetsByPt_2_btagCSV jetsByPt_2_btagCSV 20,0,1
  jetsByPt_3_btagCSV jetsByPt_3_btagCSV 20,0,1
  jetsByPt_0_eta jetsByPt_0_eta 20,-2.5,2.5
  jetsByPt_1_eta jetsByPt_1_eta 20,-2.5,2.5
  jetsByPt_2_eta jetsByPt_2_eta 20,-2.5,2.5
  jetsByPt_3_eta jetsByPt_3_eta 20,-2.5,2.5
  jetsByPt_0_btagCSV jetsByPt_0_btagCSV 100,0,1
  jetsByPt_1_btagCSV jetsByPt_1_btagCSV 100,0,1
  jetsByPt_2_btagCSV jetsByPt_2_btagCSV 100,0,1
  jetsByPt_3_btagCSV jetsByPt_3_btagCSV 100,0,1
  Wmass Wmass 80,0,200
cuts:
  is_sl 1 2
  numJets 4 1000
  nBDeepCSVM 2 1000

[sl_jge6_t3]
template: template_sl
discriminator: btag_LR_4b_2b_btagCSV_logit btag_LR_4b_2b_btagCSV_logit 6,1,6
control_variables:
  btag_LR_4b_2b_btagCSV_logit_fine btag_LR_4b_2b_btagCSV_logit 30,-10,10
  jetsByPt_0_pt jetsByPt_0_pt 1,0,1000
  jetsByPt_1_pt jetsByPt_1_pt 1,0,1000
  jetsByPt_2_pt jetsByPt_2_pt 1,0,1000
  jetsByPt_3_pt jetsByPt_3_pt 1,0,1000
  leps_0_pt leps_0_pt 1,0,1000
  leps_0_eta leps_0_eta 100,-2.5,2.5
  jetsByPt_0_btagCSV jetsByPt_0_btagCSV 6,0.5,1
  jetsByPt_1_btagCSV jetsByPt_1_btagCSV 6,0,1
  jetsByPt_2_btagCSV jetsByPt_2_btagCSV 6,0.5,1
  jetsByPt_3_btagCSV jetsByPt_3_btagCSV 6,0.5,1
  jetsByPt_0_eta jetsByPt_0_eta 0.1,-2.5,2.5
  jetsByPt_1_eta jetsByPt_1_eta 0.1,-2.5,2.5
  jetsByPt_2_eta jetsByPt_2_eta 0.1,-2.5,2.5
  jetsByPt_3_eta jetsByPt_3_eta 0.1,-2.5,2.5
  met_pt met_pt 10,0,200
  ht ht 10,300,1500
cuts:
  is_sl 1 2
  numJets 4 1000 
  nBCSVM 0 1000

[sparsinator]
do_classifier_db: false
calculate_bdt: false
add_systematics: False
recompute_btag_weights: false
do_hadronic: False


[systematics]
sample: 

